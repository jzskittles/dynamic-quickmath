<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Quick Math</title>
    <link rel="stylesheet" type="text/css" href="/css/question.css">
</head>

<body>
    <form action="/header" method="post">
        <input id="back" type="submit" formaction="/back" value= "Back" style="background-color:crimson; border:2px; font-size: 20px; width:75px; text-align:center; color:white;">
        <input type="hidden" id="doc" name="title" value="Problem">
        <input id="hs" name="hs" type="hidden" value="<%- hs %>">
        <input id="lang" name="lang" type="hidden" value="<%- language %>">
        <input id="user" name="username" type="hidden" value="<%- username %>">
        <input id="session" name="session" type="hidden" value="<%- session %>">
        

        <div style="float:right; margin-top:10px;">
            
            <input id="streakhs" name="streak" type="hidden" value="0">
            <input id="streaktotal" name="streaktotal" type="hidden" value="0">
            <h2 id="streak">0</h2>
            <h2 style="float: right"><img src="/images/flame.png" alt="streak flame"></h2>
            <input id="higheststreak" name="higheststreak" type="hidden" value="0"> <!--for this game-->
                <input id="dbhigheststreak" name="dbhigheststreak" type="hidden" value="0"> <!--for all plays across all players-->
                <h2 id="hstreak" style="text-align: right; color:crimson;">0</h2>
        </div>
        
    </form>

    <table id="probtable" style="display:block">
        <tr>
            <% if(category === "two"){ %>
                <td><h2 id="part1" class="prob">123</h2></td>
                <td><h2 id="sign" class="prob"><%= sign %></h2></td>
                <td><h2 id="part2" class="prob">123</h2></td>
            <% } %>
            <% if(category === "three"){ %>
                <td><h2 id="part1" class="prob">123</h2></td>
                <td><h2 id="sign" class="prob"><%= sign %></h2></td>
                <td><h2 id="part2" class="prob">123</h2></td>
                <td><h2 id="sign2" class="prob"><%= sign %></h2></td>
                <td><h2 id="part3" class="prob">123</h2></td>
            <% } %>
        </tr>
    </table>
    
    <main>
        <% include /Users/jenny/dynamic-quickmath/views/partials/numpad %>
    </main>
    <% if(category === "two"){ %>
        <script>
            var result=0;
            var streaknum = 0;
            
            var languages = "<%- language %>";
            var session = "<%- session%>";
            console.log(session);

            if(languages==="en"){
                document.getElementById("enter").textContent="ENTER";
                document.getElementById("back").value = "Back";
            }
            if(languages==="zh"){
                document.getElementById("enter").textContent="抢答";
                document.getElementById("enter").style.fontWeight="bold";
                document.getElementById("back").value = "退出";
                document.getElementById("back").style.fontWeight="bold";

            }
            function addText(clicked_id) {
                if(document.getElementById("answer").textContent.length<12)
                    document.getElementById("answer").textContent = document.getElementById("answer").textContent + clicked_id;
            }
            function removeText(){
                if(document.getElementById("answer").textContent.length>2){
                    var str = document.getElementById("answer").textContent;
                    str = str.substring(0, str.length - 1);
                    document.getElementById("answer").textContent = str;
                }    
            }
            function randomNum(){
                var a = Math.floor((Math.random() * 100) + 1);
                var b = Math.floor((Math.random() * 100) + 1);

                var c=0;
                if(((Math.random()*100) + 1)>50)
                    c = 1;

                var probtable = document.getElementById("probtable");
                var items = probtable.getElementsByTagName("h2");
                var signs = items[1].textContent;
                if(c==0){
                    if(signs==="+"||signs==="-"){
                        items[1].textContent="+";
                        result = a+b;
                    }
                    if(signs==="x"||signs==="/"){
                        items[1].textContent="x";
                        result = a*b;
                    }
                    
                }else{
                    if(signs==="+"||signs==="-"){
                        items[1].textContent="-";
                        if(b>a){
                            var m = a;
                            a = b;
                            b = m;
                        }
                        result = a-b;
                    }
                    if(signs==="x"||signs==="/"){
                        items[1].textContent="/";
                        result = a;
                        a = a*b;
                    }  
                }
                if(signs===""||signs==="%"){
                    var b = Math.floor((Math.random() * 30) + 3);
                    items[1].textContent="%";
                    if(a<b){
                        var m = a;
                        a=b;
                        b=m;
                    }
                    result = a%b;
                }

                items[0].textContent = a;
                items[2].textContent = b;
            }
            var totalsolved = 0;
            var highscore = 0;
            function compare(){
                var answers = document.getElementById("answer").textContent;
                
                if(answers.substring(2) == result){
                    streaknum++;
                    totalsolved++;
                    if(streaknum>highscore){
                        highscore = streaknum;
                    }
                }else{
                    streaknum=0;
                }
                document.getElementById("hstreak").textContent = highscore;
                document.getElementById("higheststreak").value = highscore;
                document.getElementById("streaktotal").value = totalsolved;
                document.getElementById("streakhs").value = streaknum;
                document.getElementById("streak").textContent = streaknum;
                document.getElementById("answer").textContent = "= ";

                randomNum();
            }
            randomNum();
        </script>
    <% } %>

    <% if(category === "three"){ %>
        <script>
            var result=0;
            var streaknum = 0;
            var languages = "<%- language %>";

            if(languages==="en"){
                document.getElementById("enter").textContent="ENTER";
                document.getElementById("back").value = "Back";
            }
            if(languages==="zh"){
                document.getElementById("enter").textContent="抢答";
                document.getElementById("back").value = "退出";
            }
            function addText(clicked_id) {
                if(document.getElementById("answer").textContent.length<12)
                    document.getElementById("answer").textContent = document.getElementById("answer").textContent + clicked_id;
            }
            function removeText(){
                if(document.getElementById("answer").textContent.length>2){
                    var str = document.getElementById("answer").textContent;
                    str = str.substring(0, str.length - 1);
                    document.getElementById("answer").textContent = str;
                }    
            }
            function randomNum(){
                var probtable = document.getElementById("probtable");
                var items = probtable.getElementsByTagName("h2");
                var sign = items[1].textContent; 
                var signs = items[3].textContent; 

                var n=0;
                var o=0;
                if(((Math.random()*100) + 1)>50)
                    n = 1;
                if(((Math.random()*100) + 1)>50)
                    o = 1; 

                if(sign=="+"||sign=="-"){
                    var a = Math.floor((Math.random() * 98) + 1);
                    var b = Math.floor((Math.random() * 98) + 1);
                    var c = Math.floor((Math.random() * 98) + 1);

                    
                    if(n==0){
                        items[1].textContent="+";
                        result = a+b;
                    }else{
                        items[1].textContent="-";
                        if(b>a){
                            var m = a;
                            a = b;
                            b = m;
                        }
                        result = a-b;
                    }

                    if(o==0){
                        items[3].textContent="+";
                        result = result + c;
                    }else{
                        items[3].textContent="-";
                        if(c>result){
                            items[3].textContent="+";
                            result = result + c;
                        }else{
                            result = result-c;
                        }
                    }
                    
                    items[0].textContent = a;
                    items[2].textContent = b;
                    items[4].textContent = c;
                }
                if(sign=="x"|| sign=="/"){
                    var a = Math.floor((Math.random() * 60) + 1);
                    var b = Math.floor((Math.random() * 30) + 1);
                    var c = Math.floor((Math.random() * 10) + 1);

                    var probtable = document.getElementById("probtable");
                    var items = probtable.getElementsByTagName("h2");
                    if(n==0){
                        items[1].textContent="x";
                        result = a*b;
                    }else{
                        items[1].textContent="/";
                        result = a;
                        a = a*b;
                    }

                    if(o==0){
                        items[3].textContent="x";
                        result = result*c;
                    }else{
                        items[3].textContent="/";
                        if(result%c==0){
                            result = result/c;
                        }else{
                            var possdiv = [];
                            for(i=2;i<10;i++){
                                if(result%i==0){
                                    possdiv.push(i);
                                }
                            }
                            if(possdiv.length>0){
                                c = possdiv[Math.floor(Math.random() * possdiv.length)];
                                result = result/c;
                            }
                            else{
                                c = 1;
                            }
                        }
                    }
                    items[0].textContent = a;
                    items[2].textContent = b;
                    items[4].textContent = c;
                }  
                if(sign==""||sign=="%"){
                    var a = Math.floor((Math.random() * 50) + 10);
                    var b = Math.floor((Math.random() * 30) + 5);
                    var c = Math.floor((Math.random() * 8) + 3);

                    var n=0;
                    if(((Math.random()*100) + 1)>50)
                        n = 1;

                    var probtable = document.getElementById("probtable");
                    var items = probtable.getElementsByTagName("h2");
                    if(n==0){
                        items[1].textContent="x";
                        result = a*b;
                    }else{
                        items[1].textContent="/";
                        result = a;
                        a = a*b;
                    }

                    items[3].textContent="/";
                    if(result>c){
                        result = result % c;
                    }else{
                        randomNum();
                    }

                    items[0].textContent = a;
                    items[2].textContent = b;
                    items[4].textContent = c;
                }    
            }
            var totalsolved = 0;
            function compare(){
                var answers = document.getElementById("answer").textContent;
                
                if(answers.substring(2) == result){
                    streaknum++;         
                    totalsolved++;       
                }else{
                    streaknum=0;
                }
                document.getElementById("streaktotal").value = totalsolved;
                document.getElementById("streakhs").value = streaknum;
                document.getElementById("streak").textContent = streaknum;
                document.getElementById("answer").textContent = "= ";
                randomNum();
            } 
            randomNum();        
        </script>
    <% } %>

    <noscript>Sorry, it looks like your browser doesn't support Javascript or have it enabled.</noscript>

</body>
</html>